<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CCRI Cyberknights Communications</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header-logo {
            margin-top: 30px;
            margin-bottom: 20px;
        }

        .logo-image {
            max-width: 200px;
            height: auto;
            border-radius: 20px;
            box-shadow: 0 12px 35px rgba(0,0,0,0.25);
            transition: all 0.3s ease;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.15));
        }

        .logo-image:hover {
            transform: scale(1.08);
            box-shadow: 0 16px 45px rgba(0,0,0,0.35);
        }

        /* Email Auto-completion Styles - Inline Text Completion */
        .email-input-container {
            position: relative;
        }
        
        .email-input {
            background: transparent;
            position: relative;
            z-index: 2;
        }
        
        .email-suggestion-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 1;
            color: #888;
            font-size: inherit;
            font-family: inherit;
            padding: inherit;
            border: none;
            background: transparent;
            white-space: pre;
        }

        /* Copy completion feedback styles */
        .copy-completed {
            background-color: #d4edda !important;
            border-color: #c3e6cb !important;
            color: #155724 !important;
            transition: all 0.3s ease;
        }

        .message-completed {
            background-color: #d4edda !important;
            border: 2px solid #28a745 !important;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .sent-checkbox {
            transition: all 0.3s ease;
        }

        .sent-checkbox.checked {
            background-color: #28a745 !important;
            border-color: #28a745 !important;
        }

        .sent-checkbox.checked::after {
            content: "✓";
            color: white;
            font-weight: bold;
            font-size: 16px;
        }

        .field-text.content.copy-completed {
            background-color: #d4edda !important;
            border: 2px solid #c3e6cb !important;
            color: #155724 !important;
            padding: 8px !important;
            border-radius: 4px !important;
        }


        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .card h2 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        /* Spreadsheet Styles */
        .spreadsheet-container {
            overflow-x: auto;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
        }

        .spreadsheet-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .spreadsheet-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            border: 1px solid #4a5568;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .spreadsheet-table td {
            padding: 0;
            border: 1px solid #e2e8f0;
            position: relative;
        }

        .spreadsheet-table input {
            width: 100%;
            padding: 12px;
            border: none;
            outline: none;
            background: transparent;
            font-size: 14px;
            font-family: inherit;
            transition: background-color 0.2s ease;
        }

        .spreadsheet-table input:focus {
            background-color: #f7fafc;
            box-shadow: inset 0 0 0 2px #667eea;
        }

        .spreadsheet-table input:not(:placeholder-shown) {
            background-color: #f7fafc;
        }

        .row-number {
            background: #f7fafc;
            color: #718096;
            font-weight: 600;
            text-align: center;
            width: 50px;
            padding: 12px 8px;
            border-right: 2px solid #e2e8f0;
        }

        .actions-column {
            background: #f7fafc;
            width: 80px;
            text-align: center;
            padding: 8px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 2px;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: #e53e3e;
        }

        .btn-success {
            background: #48bb78;
        }

        .btn-secondary {
            background: #718096;
        }

        .btn-small {
            padding: 4px 8px;
            font-size: 11px;
        }

        /* Toolbar */
        .toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .toolbar .btn {
            margin: 0;
        }

        /* Template Panel */
        .template-panel {
            max-height: 600px;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .message-preview {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .message-preview.sent {
            background: #f0fff4;
            border-color: #9ae6b4;
            opacity: 0.7;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .message-recipient {
            font-weight: 600;
            color: #2d3748;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .message-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .message-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #48bb78;
        }

        .message-fields {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message-field {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .field-label {
            font-weight: 600;
            color: #4a5568;
            font-size: 14px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .field-content {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 12px;
            min-height: 40px;
        }

        .field-text {
            flex: 1;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 14px;
            line-height: 1.5;
            color: #2d3748;
            white-space: pre-wrap;
            word-wrap: break-word;
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
        }

        .field-text.subject {
            font-weight: 600;
        }

        .field-text.content {
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
        }

        .copy-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .copy-btn:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .copy-btn:active {
            transform: translateY(0);
        }

        .copy-btn.copied {
            background: #48bb78;
        }

        .copy-feedback {
            position: absolute;
            background: #48bb78;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            pointer-events: none;
            z-index: 1000;
            animation: fadeInOut 1.5s ease-in-out;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(-10px); }
            20% { opacity: 1; transform: translateY(0); }
            80% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-10px); }
        }

        #messagesContainer {
            margin-top: 20px;
        }

        .messages-summary {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
        }

        .summary-stats {
            display: flex;
            gap: 20px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stat-number {
            font-weight: bold;
            color: #667eea;
        }

        @media (max-width: 768px) {
            .message-preview {
                padding: 15px;
            }
            
            .message-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .message-fields {
                gap: 12px;
            }
            
            .field-content {
                flex-direction: column;
                gap: 8px;
            }
            
            .copy-btn {
                align-self: flex-start;
            }
            
            .messages-summary {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .summary-stats {
                justify-content: center;
            }
        }


        .hidden {
            display: none;
        }

        .alert {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background-color: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }

        .alert-error {
            background-color: #fed7d7;
            color: #742a2a;
            border: 1px solid #feb2b2;
        }

        .file-upload {
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: border-color 0.3s ease;
            cursor: pointer;
            margin-bottom: 15px;
        }

        .file-upload:hover {
            border-color: #667eea;
        }

        .file-upload.dragover {
            border-color: #667eea;
            background-color: #f7fafc;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* Footer Styles */
        .footer {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 30px 0;
            margin-top: 50px;
            text-align: center;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .footer-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: opacity 0.3s ease;
        }

        .footer-links a:hover {
            opacity: 0.8;
        }

        .footer-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .footer-brand {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .footer-brand h3 {
            font-size: 1.2rem;
            margin: 0;
        }

        .footer-version {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .footer-copyright {
            font-size: 0.9rem;
            opacity: 0.8;
            margin: 0;
        }


        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .header-logo {
                margin-top: 25px;
                margin-bottom: 15px;
            }
            
            .logo-image {
                max-width: 160px;
            }
            
            .toolbar {
                flex-direction: column;
                align-items: stretch;
            }
            

            .footer-info {
                flex-direction: column;
                text-align: center;
            }

            .footer-links {
                gap: 20px;
            }

            .footer-links a {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>CCRI Cyberknights Communications</h1>
            <p>Spreadsheet-style contact management and message generation</p>
            <div class="header-logo">
                <picture>
                    <source srcset="art-optimized.webp" type="image/webp">
                    <img src="art-optimized.jpg" alt="CCRI Cyberknights Logo" class="logo-image">
                </picture>
            </div>
        </div>

        <div id="alert-container"></div>

        <div class="main-content">
            <!-- Contact Spreadsheet -->
            <div class="card">
                <h2>📊 Contact Spreadsheet</h2>
                

                <div class="toolbar">
                    <button class="btn" onclick="addRow()">Add Row</button>
                    <button class="btn btn-secondary" onclick="clearAll()">Clear All</button>
                    <button class="btn btn-success" onclick="exportData()">Export CSV</button>
                    <button class="btn btn-secondary" onclick="importData()">Import CSV</button>
                    <input type="file" id="fileInput" accept=".csv" style="display: none;" onchange="handleFileImport(event)">
                </div>

                <div class="spreadsheet-container">
                    <table class="spreadsheet-table" id="contactsTable">
                        <thead>
                            <tr>
                                <th class="row-number">#</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th class="actions-column">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="contactsTableBody">
                            <!-- Rows will be generated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Message Templates -->
            <div class="card">
                <h2>✉️ Message Templates</h2>
                
                <div class="template-panel">
                    <div class="form-group">
                        <label for="templateSelect">Select Template:</label>
                        <select id="templateSelect" onchange="loadTemplate()">
                            <option value="">Choose a template...</option>
                            <option value="webform">New Member Welcome (Web Form)</option>
                            <option value="email-outreach">New Member Welcome (Email Outreach)</option>
                            <option value="club-fair">Club Fair Follow-up</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="messageTemplate">Message Template:</label>
                        <textarea id="messageTemplate" rows="8" placeholder="Select a template or write your own message..."></textarea>
                    </div>
                    
                    <button class="btn" onclick="generateMessages()">Generate Messages</button>
                    <button class="btn btn-secondary" onclick="clearTemplate()">Clear Template</button>
                </div>
            </div>
        </div>

        <!-- Generated Messages Section -->
        <div id="generatedMessages" class="card hidden">
            <h2>✉️ Generated Messages</h2>
            <div id="messagesSummary" class="messages-summary hidden">
                <div class="summary-stats">
                    <div class="stat-item">
                        <span class="stat-number" id="totalMessages">0</span>
                        <span>Total Messages</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="sentMessages">0</span>
                        <span>Sent</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="remainingMessages">0</span>
                        <span>Remaining</span>
                    </div>
                </div>
                <div>
                    <button class="btn btn-secondary" onclick="clearAllSent()">Clear All Sent</button>
                </div>
            </div>
            <div id="messagesContainer"></div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <h2>⚡ Quick Actions</h2>
            <div class="toolbar">
                <button class="btn btn-success" onclick="openGitHub()">View on GitHub</button>
                <button class="btn btn-secondary" onclick="downloadTemplate()">Download CSV Template</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let contacts = [];
        let nextRowId = 1;
        let currentTemplate = '';
        let sentMessages = new Set(); // Track which messages have been sent

        // Club configuration - single source of truth for all links
        const clubConfig = {
            discord: 'https://discord.com/channels/1159622463647387719/1159622463647387722',
            membershipForm: 'https://forms.cloud.microsoft/r/U26WUVJGgp',
            website: 'https://www.ccri.edu/comp/cybersecurity/studentclub.html',
            meetingSchedule: 'https://ccri-cyberknights.github.io/page/#/calendar',
            meetingFrequency: 'weekly'
        };

        // Email auto-completion configuration
        const emailDomains = [
            '@gmail.com',
            '@my.ccri.edu',
            '@outlook.com',
            '@yahoo.com',
            '@hotmail.com'
        ];

        // Function to replace placeholders in templates with actual values
        function replaceTemplatePlaceholders(template) {
            return template
                .replace(/\[Discord Link\]/g, clubConfig.discord)
                .replace(/\[Web Form Link\]/g, clubConfig.membershipForm)
                .replace(/\[Website URL\]/g, clubConfig.website)
                .replace(/\[Meeting Info\]/g, clubConfig.meetingSchedule)
                .replace(/\[schedule\]/g, clubConfig.meetingFrequency);
        }

        function parseName(name) {
            // Handle names in "Last, First" format
            if (name.includes(',')) {
                const parts = name.split(',').map(part => part.trim());
                if (parts.length >= 2) {
                    // Extract first name (second part) and last name (first part)
                    const lastName = parts[0];
                    const firstName = parts[1];
                    
                    // Remove any parenthetical content from first name (like "(cdavis24)")
                    let cleanFirstName = firstName.replace(/\s*\([^)]*\)\s*$/, '').trim();
                    
                    // Remove middle initials (single letters followed by space or end)
                    cleanFirstName = cleanFirstName.replace(/\s+[A-Z]\s*$/, '').trim();
                    
                    // Return in "First Last" format
                    return `${cleanFirstName} ${lastName}`;
                }
            }
            
            // Return original name if no comma found or parsing fails
            return name;
        }

        // Test the parseName function with examples
        function testNameParsing() {
            const testCases = [
                'Davis, Corey A (cdavis24)', // Should become "Corey Davis"
                'Smith, John', // Should become "John Smith"
                'Johnson, Mary Jane', // Should become "Mary Jane Johnson"
                'Brown, Robert (rbrown123)', // Should become "Robert Brown"
                'Wilson, Sarah M', // Should become "Sarah Wilson" (middle initial removed)
                'John Doe', // No comma - should remain unchanged
                'Jane Smith-Wilson' // No comma - should remain unchanged
            ];
            
            console.log('Testing name parsing:');
            testCases.forEach(testName => {
                const parsed = parseName(testName);
                console.log(`"${testName}" → "${parsed}"`);
            });
        }

        // Email auto-completion functions
        function setupEmailAutoCompletion() {
            // Set up auto-completion for existing email inputs
            setupEmailInputs();
            
            // Set up auto-completion for dynamically added email inputs
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList') {
                        setupEmailInputs();
                    }
                });
            });
            
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
        }

        function setupEmailInputs() {
            const emailInputs = document.querySelectorAll('.email-input');
            
            emailInputs.forEach((input) => {
                if (!input.hasAttribute('data-autocomplete-setup')) {
                    input.setAttribute('data-autocomplete-setup', 'true');
                    input.addEventListener('input', handleEmailInput);
                    input.addEventListener('blur', hideSuggestions);
                    input.addEventListener('keydown', handleEmailKeydown);
                }
            });
        }

        function handleEmailInput(event) {
            const input = event.target;
            const value = input.value;
            
            // Check if user is typing after @ symbol
            const atIndex = value.lastIndexOf('@');
            if (atIndex === -1) {
                hideSuggestions();
                return;
            }
            
            const domainPart = value.substring(atIndex);
            
            if (domainPart.length < 2) {
                hideSuggestions();
                return;
            }
            
            // Find matching domains
            const matches = emailDomains.filter(domain => 
                domain.toLowerCase().startsWith(domainPart.toLowerCase())
            );
            
            if (matches.length > 0) {
                showSuggestions(input, matches, domainPart);
            } else {
                hideSuggestions();
            }
        }

        function showSuggestions(input, matches, typedPart) {
            // Remove existing suggestions
            hideSuggestions();
            
            if (matches.length === 0) {
                return;
            }
            
            // Get the first (best) match
            const bestMatch = matches[0];
            const remainingText = bestMatch.substring(typedPart.length);
            
            // Create overlay element for the grey suggestion text
            const overlay = document.createElement('input');
            overlay.className = 'email-suggestion-overlay';
            overlay.value = input.value + remainingText;
            overlay.readOnly = true;
            overlay.id = 'email-suggestion-overlay';
            
            // Add overlay to the same container as the input
            const container = input.closest('.email-input-container');
            if (container) {
                container.appendChild(overlay);
                
                // Position overlay exactly over the input
                const inputRect = input.getBoundingClientRect();
                const containerRect = container.getBoundingClientRect();
                overlay.style.top = (inputRect.top - containerRect.top) + 'px';
                overlay.style.left = (inputRect.left - containerRect.left) + 'px';
                overlay.style.width = inputRect.width + 'px';
                overlay.style.height = inputRect.height + 'px';
            }
        }

        function hideSuggestions() {
            const existingOverlay = document.getElementById('email-suggestion-overlay');
            if (existingOverlay) {
                existingOverlay.remove();
            }
        }

        function handleEmailKeydown(event) {
            const overlay = document.getElementById('email-suggestion-overlay');
            if (!overlay) return;
            
            switch (event.key) {
                case 'Tab':
                case 'Enter':
                    event.preventDefault();
                    // Accept the suggestion
                    const input = event.target;
                    input.value = overlay.value;
                    hideSuggestions();
                    break;
                case 'Escape':
                    hideSuggestions();
                    break;
            }
        }


        // Page leave warning functionality
        function hasUnsavedData() {
            // Check if there are any contacts with data
            return contacts.some(contact => contact.name.trim() || contact.email.trim());
        }

        function setupPageLeaveWarning() {
            window.addEventListener('beforeunload', function(event) {
                if (hasUnsavedData()) {
                    const message = 'You have unsaved data. Are you sure you want to leave?';
                    event.returnValue = message;
                    return message;
                }
            });
        }

        // Template definitions
        const templates = {
            'webform': `Subject: Welcome to CCRI Cyberknights! 🛡️

Hi {{name}},

Welcome to the CCRI Cyberknights! We're excited to have you join our cybersecurity community.

## Next Steps

1. **Join our Discord server**: [Discord Link]
   - This is where we coordinate meetings, share resources, and chat about cybersecurity topics
   - Please introduce yourself in the #introductions channel

2. **Check out our upcoming events**: We'll be posting meeting times and special events in Discord

3. **Get involved**: Feel free to ask questions, share interesting articles, or suggest topics for future meetings

## Important Links

- **Discord Server**: [Discord Link]
- **Club Website**: [Website URL]
- **Meeting Schedule**: [Meeting Info]

If you have any questions, don't hesitate to reach out to any of our officers or post in Discord.

Looking forward to seeing you at our next meeting!

Best regards,
The CCRI Cyberknights Leadership Team`,

            'email-outreach': `Subject: Welcome to CCRI Cyberknights! 🛡️

Hi {{name}},

Thank you for your interest in the CCRI Cyberknights! We're excited to have you join our cybersecurity community.

## Getting Started

Since you provided your email directly, here are two ways to get involved:

### Option 1: Join our Discord (Recommended)
- **Discord Server**: [Discord Link]
- This is our primary communication hub for meetings, resources, and discussions
- Please introduce yourself in the #introductions channel

### Option 2: Fill out our official membership form
- **Web Form**: [Web Form Link]
- This helps us keep track of all members and send important updates

## What to Expect

- **Regular meetings**: We meet [schedule] to discuss cybersecurity topics, practice skills, and plan activities
- **Hands-on learning**: CTF competitions, workshops, and guest speakers
- **Networking**: Connect with fellow cybersecurity enthusiasts and industry professionals
- **Resources**: Access to study materials, tools, and career guidance

## Important Links

- **Discord Server**: [Discord Link]
- **Membership Form**: [Web Form Link]
- **Club Website**: [Website URL]
- **Meeting Schedule**: [Meeting Info]

## Questions?

Feel free to reach out to any of our officers or post in Discord. We're here to help you get the most out of your Cyberknights experience!

Welcome aboard!

Best regards,
The CCRI Cyberknights Leadership Team`,

            'club-fair': `Subject: Thanks for your interest in CCRI Cyberknights! 🛡️

Hi {{name}},

Thank you for stopping by our table at the club fair! We're excited about your interest in the CCRI Cyberknights cybersecurity club.

## What We're About

The CCRI Cyberknights is a student organization focused on cybersecurity education, hands-on learning, and professional development. We offer:

- **CTF Competitions**: Test your skills in Capture The Flag challenges
- **Workshops**: Learn about ethical hacking, network security, and more
- **Guest Speakers**: Industry professionals share insights and career advice
- **Networking**: Connect with fellow cybersecurity enthusiasts

## Get Involved

1. **Join our Discord**: [Discord Link]
2. **Fill out our membership form**: [Web Form Link]
3. **Attend our next meeting**: Check our calendar at [Meeting Info]

## Important Links

- **Discord Server**: [Discord Link]
- **Membership Form**: [Web Form Link]
- **Club Website**: [Website URL]
- **Meeting Schedule**: [Meeting Info]

## Questions?

Feel free to reach out if you have any questions about the club or cybersecurity in general. We'd love to hear from you!

Best regards,
The CCRI Cyberknights Leadership Team`
        };

        // Utility functions
        function showAlert(message, type = 'success') {
            const alertContainer = document.getElementById('alert-container');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alertContainer.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }


        function createRow(rowId, name = '', email = '') {
            const row = document.createElement('tr');
            row.id = `row-${rowId}`;
            row.innerHTML = `
                <td class="row-number">${rowId}</td>
                <td>
                    <input type="text" 
                           placeholder="Enter name..." 
                           value="${name}"
                           oninput="handleInput(${rowId}, 'name', this.value, this)"
                           onkeydown="handleKeyDown(event, ${rowId})">
                </td>
                <td class="email-input-container">
                    <input type="email" 
                           placeholder="Enter email..." 
                           value="${email}"
                           oninput="handleInput(${rowId}, 'email', this.value, this)"
                           onkeydown="handleKeyDown(event, ${rowId})"
                           class="email-input">
                </td>
                <td class="actions-column">
                    <button class="btn btn-danger btn-small" onclick="removeRow(${rowId})" title="Delete row">×</button>
                </td>
            `;
            return row;
        }

        function addRow(name = '', email = '') {
            const rowId = nextRowId++;
            const row = createRow(rowId, name, email);
            document.getElementById('contactsTableBody').appendChild(row);
            
            // Add to contacts array
            contacts.push({ id: rowId, name, email });
            
            // Focus on the name input of the new row
            const nameInput = row.querySelector('input[type="text"]');
            nameInput.focus();
        }

        function removeRow(rowId) {
            // Remove from DOM
            const row = document.getElementById(`row-${rowId}`);
            if (row) {
                row.remove();
            }
            
            // Remove from contacts array
            contacts = contacts.filter(contact => contact.id !== rowId);
        }

        function handleInput(rowId, field, value, inputElement) {
            const contact = contacts.find(c => c.id === rowId);
            if (contact) {
                contact[field] = value;
            }
            
            // Handle email auto-completion
            if (field === 'email' && inputElement) {
                handleEmailInput({ target: inputElement });
            }
        }
        
        // Make handleInput globally accessible
        window.handleInput = handleInput;

        function handleKeyDown(event, rowId) {
            // Handle Enter key to move to next field
            if (event.key === 'Enter') {
                event.preventDefault();
                const currentInput = event.target;
                const row = document.getElementById(`row-${rowId}`);
                const inputs = row.querySelectorAll('input');
                const currentIndex = Array.from(inputs).indexOf(currentInput);
                
                if (currentIndex < inputs.length - 1) {
                    inputs[currentIndex + 1].focus();
                } else {
                    // If we're on the last input of the row, check if we're in the last row
                    const rows = document.querySelectorAll('#contactsTableBody tr');
                    const lastRow = rows[rows.length - 1];
                    
                    if (row === lastRow) {
                        // Add a new row and focus on its first input
                        addRow();
                    } else {
                        // Move to the next row's first input
                        const nextRow = rows[Array.from(rows).indexOf(row) + 1];
                        if (nextRow) {
                            const nextInput = nextRow.querySelector('input[type="text"]');
                            if (nextInput) {
                                nextInput.focus();
                            }
                        }
                    }
                }
            }
            
            // Handle Delete key on empty inputs
            if (event.key === 'Delete' || event.key === 'Backspace') {
                const currentInput = event.target;
                if (!currentInput.value && contacts.length > 1) {
                    // Only allow deletion if there's more than one row
                    removeRow(rowId);
                }
            }
        }

        function clearAll() {
            if (confirm('Are you sure you want to clear all contacts?')) {
                contacts = [];
                nextRowId = 1;
                document.getElementById('contactsTableBody').innerHTML = '';
                addRow(); // Add one empty row
                showAlert('All contacts cleared');
            }
        }


        function clearAllForImport() {
            // Clear all contacts for import without adding empty row
            contacts = [];
            nextRowId = 1;
            document.getElementById('contactsTableBody').innerHTML = '';
        }

        function exportData() {
            const validContacts = contacts.filter(contact => contact.name.trim() && contact.email.trim());
            
            if (validContacts.length === 0) {
                showAlert('No contacts to export', 'error');
                return;
            }
            
            const csvContent = 'Name,Email\n' + 
                validContacts.map(contact => `"${contact.name}","${contact.email}"`).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'cyberknights_contacts.csv';
            a.click();
            window.URL.revokeObjectURL(url);
            
            showAlert(`Exported ${validContacts.length} contacts to CSV`);
        }

        function importData() {
            document.getElementById('fileInput').click();
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const csv = e.target.result;
                const lines = csv.split('\n');
                
                if (lines.length < 2) {
                    showAlert('Invalid CSV file', 'error');
                    return;
                }
                
                // Check if there are existing contacts to clear
                const existingContacts = contacts.filter(contact => contact.name.trim() || contact.email.trim());
                
                if (existingContacts.length > 0) {
                    // Ask for confirmation only if there are actual contacts to clear
                    if (confirm('This will replace your existing contacts. Are you sure you want to continue?')) {
                        clearAllForImport();
                    } else {
                        showAlert('Import cancelled', 'error');
                        return;
                    }
                } else {
                    // No existing contacts, clear silently
                    clearAllForImport();
                }
                
                let importedCount = 0;
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;
                    
                    // Simple CSV parsing (handles quoted values)
                    const values = line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
                    if (values && values.length >= 2) {
                        const name = values[0].replace(/"/g, '').trim();
                        const email = values[1].replace(/"/g, '').trim();
                        
                        if (name && email && isValidEmail(email)) {
                            addRow(name, email);
                            importedCount++;
                        }
                    }
                }
                
                // Add an empty row only if no contacts were imported
                if (importedCount === 0) {
                    addRow();
                }
                
                showAlert(`Imported ${importedCount} contacts from CSV`);
            };
            reader.readAsText(file);
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function loadTemplate() {
            const templateSelect = document.getElementById('templateSelect');
            const messageTemplate = document.getElementById('messageTemplate');
            
            if (templateSelect.value && templates[templateSelect.value]) {
                // Replace placeholders with actual values from clubConfig
                const templateWithLinks = replaceTemplatePlaceholders(templates[templateSelect.value]);
                messageTemplate.value = templateWithLinks;
                currentTemplate = templateSelect.value;
            }
        }

        function generateMessages() {
            const messageTemplate = document.getElementById('messageTemplate').value;
            
            if (!messageTemplate.trim()) {
                showAlert('Please enter a message template', 'error');
                return;
            }
            
            const validContacts = contacts.filter(contact => contact.name.trim() && contact.email.trim());
            
            if (validContacts.length === 0) {
                showAlert('Please add at least one contact with name and email', 'error');
                return;
            }
            
            const messagesContainer = document.getElementById('messagesContainer');
            const generatedMessages = document.getElementById('generatedMessages');
            const messagesSummary = document.getElementById('messagesSummary');
            
            // Clear previous sent tracking for new generation
            sentMessages.clear();
            
            messagesContainer.innerHTML = validContacts.map((contact, index) => {
                const parsedName = parseName(contact.name);
                const personalizedMessage = messageTemplate.replace(/\{\{name\}\}/g, parsedName);
                const messageId = `msg-${contact.id}`;
                const isSent = sentMessages.has(messageId);
                
                // Extract subject from message template
                const subjectMatch = personalizedMessage.match(/Subject:\s*(.+)/);
                const subject = subjectMatch ? subjectMatch[1].trim() : 'No Subject';
                const messageBody = personalizedMessage.replace(/Subject:\s*.+\n\n/, '');
                
                return `
                    <div class="message-preview ${isSent ? 'sent' : ''}" id="${messageId}">
                        <div class="message-header">
                            <div class="message-recipient">Message ${index + 1}</div>
                            <div class="message-actions">
                                <label>
                                    <input type="checkbox" class="message-checkbox" 
                                           onchange="toggleMessageSent('${messageId}')" 
                                           ${isSent ? 'checked' : ''}>
                                    Sent
                                </label>
                            </div>
                        </div>
                        <div class="message-fields">
                            <div class="message-field">
                                <div class="field-label">To:</div>
                                <div class="field-content">
                                    <div class="field-text">${contact.email}</div>
                                    <button class="copy-btn" onclick="copyFieldToClipboard('${contact.email}', this)">Copy</button>
                                </div>
                            </div>
                            <div class="message-field">
                                <div class="field-label">Subject:</div>
                                <div class="field-content">
                                    <div class="field-text subject">${subject}</div>
                                    <button class="copy-btn" onclick="copyFieldToClipboard('${subject.replace(/'/g, "\\'")}', this)">Copy</button>
                                </div>
                            </div>
                            <div class="message-field">
                                <div class="field-label">Message Content:</div>
                                <div class="field-content">
                                    <div class="field-text content">${messageBody}</div>
                                    <button class="copy-btn" data-copy-text="${messageBody.replace(/"/g, '&quot;').replace(/'/g, '&#39;')}" onclick="copyFieldToClipboardFromData(this)">Copy</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            generatedMessages.classList.remove('hidden');
            messagesSummary.classList.remove('hidden');
            updateMessageStats();
            showAlert(`Generated ${validContacts.length} personalized messages!`);
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showAlert('Message copied to clipboard!');
            }).catch(err => {
                showAlert('Failed to copy message', 'error');
            });
        }

        function copyFieldToClipboard(text, button) {
            navigator.clipboard.writeText(text).then(() => {
                // Visual feedback on the button
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                button.classList.add('copied');
                
                // Mark the field as completed
                const fieldContent = button.closest('.field-content');
                const fieldText = fieldContent.querySelector('.field-text');
                fieldContent.classList.add('copy-completed');
                if (fieldText) {
                    fieldText.classList.add('copy-completed');
                }
                
                // Check if all fields are completed
                checkMessageCompletion(fieldContent);
                
                // Show floating feedback
                showCopyFeedback(button);
                
                // Reset button after 2 seconds
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                showAlert('Failed to copy to clipboard', 'error');
            });
        }

        function checkMessageCompletion(fieldContent) {
            const messagePreview = fieldContent.closest('.message-preview');
            const allFields = messagePreview.querySelectorAll('.field-content');
            const completedFields = messagePreview.querySelectorAll('.field-content.copy-completed');
            
            // Check if all three fields (To, Subject, Message Content) are completed
            if (completedFields.length === 3) {
                // Mark the entire message as completed
                messagePreview.classList.add('message-completed');
                
                // Check the sent checkbox
                const checkbox = messagePreview.querySelector('.message-checkbox');
                if (checkbox && !checkbox.checked) {
                    checkbox.checked = true;
                    checkbox.classList.add('checked');
                    
                    // Update the sent messages tracking
                    const messageId = messagePreview.id;
                    sentMessages.add(messageId);
                    updateMessageStats();
                }
            }
        }

        function copyFieldToClipboardFromData(button) {
            const text = button.getAttribute('data-copy-text');
            copyFieldToClipboard(text, button);
        }

        function showCopyFeedback(button) {
            const feedback = document.createElement('div');
            feedback.className = 'copy-feedback';
            feedback.textContent = 'Copied!';
            
            const rect = button.getBoundingClientRect();
            feedback.style.left = (rect.left + rect.width / 2) + 'px';
            feedback.style.top = (rect.top - 30) + 'px';
            
            document.body.appendChild(feedback);
            
            setTimeout(() => {
                document.body.removeChild(feedback);
            }, 1500);
        }

        function clearTemplate() {
            document.getElementById('messageTemplate').value = '';
            document.getElementById('templateSelect').value = '';
            document.getElementById('generatedMessages').classList.add('hidden');
            document.getElementById('messagesContainer').innerHTML = '';
            document.getElementById('messagesSummary').classList.add('hidden');
            sentMessages.clear();
        }

        function toggleMessageSent(messageId) {
            const messageElement = document.getElementById(messageId);
            const checkbox = messageElement.querySelector('.message-checkbox');
            
            if (checkbox.checked) {
                sentMessages.add(messageId);
                messageElement.classList.add('sent');
                checkbox.classList.add('checked');
            } else {
                sentMessages.delete(messageId);
                messageElement.classList.remove('sent');
                checkbox.classList.remove('checked');
            }
            
            updateMessageStats();
        }

        function updateMessageStats() {
            const totalMessages = document.querySelectorAll('.message-preview').length;
            const sentCount = sentMessages.size;
            const remainingCount = totalMessages - sentCount;
            
            document.getElementById('totalMessages').textContent = totalMessages;
            document.getElementById('sentMessages').textContent = sentCount;
            document.getElementById('remainingMessages').textContent = remainingCount;
        }

        function clearAllSent() {
            if (confirm('Are you sure you want to clear all sent checkboxes?')) {
                sentMessages.clear();
                
                // Update all checkboxes and styling
                document.querySelectorAll('.message-preview').forEach(message => {
                    const checkbox = message.querySelector('.message-checkbox');
                    checkbox.checked = false;
                    checkbox.classList.remove('checked');
                    message.classList.remove('sent');
                    message.classList.remove('message-completed');
                    
                    // Reset all field completion states
                    const fieldContents = message.querySelectorAll('.field-content');
                    fieldContents.forEach(field => {
                        field.classList.remove('copy-completed');
                        const fieldText = field.querySelector('.field-text');
                        if (fieldText) {
                            fieldText.classList.remove('copy-completed');
                        }
                    });
                });
                
                updateMessageStats();
                showAlert('All sent checkboxes cleared');
            }
        }


        function downloadTemplate() {
            const csvContent = 'Name,Email\n"John Doe","john.doe@example.com"\n"Jane Smith","jane.smith@example.com"';
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'contacts_template.csv';
            a.click();
            window.URL.revokeObjectURL(url);
            showAlert('CSV template downloaded!');
        }

        function openGitHub() {
            window.open('https://github.com/CCRI-Cyberknights/comms', '_blank');
        }

        // Initialize the application
        function init() {
            // Add initial empty row
            addRow();
            
            // Setup page leave warning
            setupPageLeaveWarning();
            
            // Setup email auto-completion
            setupEmailAutoCompletion();
        }

        // Start the application
        init();
    </script>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-info">
                <div class="footer-brand">
                    <h3>CCRI Cyberknights</h3>
                </div>
                <div class="footer-version">v2.1.9</div>
            </div>
            
            <div class="footer-links">
                <a href="https://github.com/CCRI-Cyberknights/comms" target="_blank">GitHub Repository</a>
                <a href="https://github.com/CCRI-Cyberknights/comms/blob/main/README.md" target="_blank">Documentation</a>
                <a href="https://github.com/CCRI-Cyberknights/comms/blob/main/USER_GUIDE.md" target="_blank">User Guide</a>
                <a href="https://github.com/CCRI-Cyberknights/comms/blob/main/SECURITY.md" target="_blank">Security</a>
                <a href="https://github.com/CCRI-Cyberknights/comms/issues" target="_blank">Report Issue</a>
            </div>
            
            
            <p class="footer-copyright">
                © 2025 CCRI Cyberknights. All rights reserved. | 
                Built with ❤️ for the cybersecurity community
            </p>
        </div>
    </footer>
</body>
</html>